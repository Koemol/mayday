<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mayday · 银河自传</title>
    <style>
        :root { --accent: #ffffff; }
        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100vh; overflow: hidden; 
            background-color: #020408; 
            font-family: "Optima", "PingFang SC", "STHeiti", "Microsoft YaHei", sans-serif; 
            color: white; user-select: none;
        }

        /* 入场封面 */
        #cover {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 2000; display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 2.5s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer;
        }
        #cover p { letter-spacing: 15px; font-weight: 200; opacity: 0.8; font-size: 1.5rem; margin: 0; }
        #cover span { font-size: 11px; margin-top: 30px; opacity: 0.4; letter-spacing: 4px; border: 1px solid #fff; padding: 6px 20px; border-radius: 30px; }

        /* 歌词区 - 精致消散效果 */
        #lyrics-container {
            position: fixed; top: 46%; left: 50%; transform: translate(-50%, -50%);
            width: 85%; text-align: center; z-index: 100; pointer-events: none;
        }
        #lyrics-text {
            font-size: 2.4rem; font-weight: 300; letter-spacing: 10px; line-height: 1.8;
            transition: all 1.2s cubic-bezier(0.2, 0, 0.2, 1);
            color: var(--accent); margin: 0;
            filter: drop-shadow(0 0 20px var(--accent));
        }
        .lyric-state-change { 
            opacity: 0; transform: scale(0.9) translateY(20px); 
            filter: blur(20px) !important; 
        }

        /* 底部导航 */
        #song-menu {
            position: fixed; bottom: 60px; left: 0; width: 100%;
            display: flex; justify-content: center; align-items: center;
            gap: 15px; flex-wrap: wrap; z-index: 1000;
        }
        .song-btn {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 10px 22px; border-radius: 40px; cursor: pointer;
            font-size: 0.85rem; transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            color: rgba(255,255,255,0.4); backdrop-filter: blur(15px);
            letter-spacing: 2px;
        }
        .song-btn:hover { border-color: white; color: white; background: rgba(255,255,255,0.1); transform: translateY(-5px); }
        .song-btn.active { 
            border-color: var(--accent); color: white; 
            box-shadow: 0 0 30px var(--accent); background: rgba(255,255,255,0.15);
        }

        #footer-note { position: fixed; bottom: 25px; left: 35px; font-size: 10px; opacity: 0.2; letter-spacing: 3px; z-index: 100; }
        canvas { display: block; }
    </style>
</head>
<body>

    <div id="cover" onclick="startApp()">
        <p>如果五月天懂你</p>
        <span>点击开启银河之旅</span>
    </div>

    <div id="footer-note">MAYDAY GALAXY · SINCE 1999</div>

    <div id="lyrics-container">
        <div id="lyrics-text">在那座 倔强的 城市里</div>
    </div>

    <div id="song-menu"></div>

    <!-- 引入 Three.js 和后期处理扩展 -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // --- 数据与主题配置 ---
        const config = {
            "顽固": { color: "#FFD700", mode: "pulse", lyrics: ["谢谢你一路陪我到这里", "心中的那个自己 还没忘记", "用全力去追那个梦的顽固", "你是不迟疑的箭 逆着风飞去"] },
            "人生海海": { color: "#00BFFF", mode: "wave", lyrics: ["无论是哪一种人生 哪怕再痛", "潮落之后一定有潮起 有什么了不起", "那是我的骄傲 太阳在等我", "明天我依然装作 快乐且洒脱"] },
            "笑忘歌": { color: "#FFB6C1", mode: "float", lyrics: ["这一生志愿只要平凡快乐", "谁说这样不伟大呢", "手牵手 一起唱 永远都记得", "天真的笑脸 依旧在开放"] },
            "一颗苹果": { color: "#FF4500", mode: "vortex", lyrics: ["时间如果我们不珍惜 就会走得很快", "活着其实很好 再吃一颗苹果", "总要有一首我的歌 哪怕没人合", "大概是 只要我现在 觉得快乐"] },
            "爱情的模样": { color: "#DA70D6", mode: "sphere", lyrics: ["你是巨大的海洋 我是雨下在你身上", "我愿在你手掌 像一个温柔的海洋", "你是爱情的模样 晴天或阴天", "在你的身上 找到我遗失的翅膀"] },
            "垃圾车": { color: "#FFFFE0", mode: "jump", lyrics: ["有你 我才没那么孤单", "你是我的垃圾车 每天为你唱歌", "虽然你偶尔会 乱发脾气", "但你是我 永远的好兄弟"] },
            "勇敢": { color: "#00FA9A", mode: "warp", lyrics: ["风若吹 乱我的头发 也不惊惶", "我知道 终会有一个未来", "等到太阳出来 看到希望", "哪怕路再长 也要勇敢去闯"] }
        };

        let currentSong = "顽固";
        let currentIndices = {};
        Object.keys(config).forEach(k => currentIndices[k] = 0);

        // --- 1. Three.js 场景搭建 ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 1, 3000);
        camera.position.z = 1000;

        const renderer = new THREE.WebGLRenderer({ antialias: false, powerPreference: "high-performance" });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // --- 2. 后期处理 (Bloom 辉光效果) ---
        const composer = new EffectComposer(renderer);
        composer.addPass(new RenderPass(scene, camera));
        
        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = 0.15;
        bloomPass.strength = 1.2;
        bloomPass.radius = 0.5;
        composer.addPass(bloomPass);

        // 生成发光贴图
        function createStarTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 64; canvas.height = 64;
            const ctx = canvas.getContext('2d');
            const gradient = ctx.createRadialGradient(32, 32, 0, 32, 32, 32);
            gradient.addColorStop(0, 'rgba(255,255,255,1)');
            gradient.addColorStop(0.2, 'rgba(255,255,255,0.8)');
            gradient.addColorStop(0.5, 'rgba(255,255,255,0.1)');
            gradient.addColorStop(1, 'rgba(255,255,255,0)');
            ctx.fillStyle = gradient; ctx.fillRect(0, 0, 64, 64);
            return new THREE.CanvasTexture(canvas);
        }
        const starTexture = createStarTexture();

        // --- 3. 粒子系统 (分层设计) ---
        const particleCount = 8000;
        const starGeo = new THREE.BufferGeometry();
        const starPos = new Float32Array(particleCount * 3);
        const starOrigPos = new Float32Array(particleCount * 3);

        for(let i=0; i<particleCount * 3; i++) {
            const p = (Math.random() - 0.5) * 2000;
            starPos[i] = p;
            starOrigPos[i] = p;
        }
        starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));

        const starMat = new THREE.PointsMaterial({
            size: 4, map: starTexture, transparent: true, blending: THREE.AdditiveBlending, depthWrite: false, opacity: 0.8
        });

        const starField = new THREE.Points(starGeo, starMat);
        scene.add(starField);

        // --- 4. 交互逻辑 ---
        let targetZoom = 1000;
        window.startApp = () => {
            document.getElementById('cover').style.opacity = '0';
            setTimeout(() => { document.getElementById('cover').style.display = 'none'; }, 2500);
        };

        function changeTheme(name, event) {
            currentSong = name;
            const data = config[name];
            
            document.querySelectorAll('.song-btn').forEach(b => b.classList.remove('active'));
            if(event) event.currentTarget.classList.add('active');

            const el = document.getElementById('lyrics-text');
            el.classList.add('lyric-state-change');
            
            setTimeout(() => {
                const idx = currentIndices[name];
                el.innerText = data.lyrics[idx];
                currentIndices[name] = (idx + 1) % data.lyrics.length;
                document.documentElement.style.setProperty('--accent', data.color);
                el.style.textShadow = `0 0 30px ${data.color}`;
                el.classList.remove('lyric-state-change');
                
                // 颜色平滑过渡
                starMat.color.set(data.color);
                nebulaMat.color.set(data.color);
            }, 800);
        }

        const menu = document.getElementById('song-menu');
        Object.keys(config).forEach(name => {
            const btn = document.createElement('div');
            btn.className = 'song-btn' + (name==='顽固'?' active':'');
            btn.innerText = name;
            btn.onclick = (e) => changeTheme(name, e);
            menu.appendChild(btn);
        });

        window.addEventListener('wheel', (e) => targetZoom = THREE.MathUtils.clamp(targetZoom + e.deltaY * 0.5, 400, 1800));

        // --- 5. 核心渲染与震撼动画逻辑 ---
        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;
            const mode = config[currentSong].mode;
            const pos = starField.geometry.attributes.position.array;

            for(let i=0; i<particleCount; i++) {
                const i3 = i * 3;
                const ox = starOrigPos[i3], oy = starOrigPos[i3+1], oz = starOrigPos[i3+2];

                switch(mode) {
                    case "pulse": // 顽固：心脏律动
                        const s = 1 + Math.sin(time * 2.5) * 0.15;
                        pos[i3] = ox * s; pos[i3+1] = oy * s; pos[i3+2] = oz * s;
                        break;
                    case "wave": // 人生海海：巨浪翻涌
                        pos[i3+1] = oy + Math.sin(time + ox*0.01) * 60;
                        pos[i3+2] = oz + Math.cos(time + oy*0.01) * 60;
                        break;
                    case "vortex": // 一颗苹果：黑洞星系
                        const angle = time * 0.5 + Math.sqrt(ox*ox + oz*oz) * 0.01;
                        const dist = Math.sqrt(ox*ox + oz*oz);
                        pos[i3] = Math.cos(angle) * dist;
                        pos[i3+2] = Math.sin(angle) * dist;
                        break;
                    case "warp": // 勇敢：光速跳跃
                        pos[i3+2] += 25;
                        if(pos[i3+2] > 1000) pos[i3+2] = -1500;
                        break;
                    case "sphere": // 爱情的模样：恒星膨胀
                        const sphereS = 1.2 + Math.sin(time * 0.5) * 0.4;
                        pos[i3] = ox * sphereS; pos[i3+1] = oy * sphereS; pos[i3+2] = oz * sphereS;
                        break;
                    case "float": // 笑忘歌：孔明灯漂浮
                        pos[i3+1] += 1.5;
                        pos[i3] += Math.sin(time + i) * 0.5;
                        if(pos[i3+1] > 1000) pos[i3+1] = -1000;
                        break;
                    case "jump": // 垃圾车：欢快粒子
                        pos[i3+1] = oy + Math.abs(Math.sin(time * 5 + i)) * 50;
                        break;
                }
            }
            starField.geometry.attributes.position.needsUpdate = true;
            
            // 星云层微动
            nebulaGroup.rotation.y += 0.001;
            nebulaGroup.children.forEach((n, idx) => {
                n.rotation.z += 0.001 * (idx + 1);
            });

            // 相机控制
            camera.position.z += (targetZoom - camera.position.z) * 0.05;
            camera.lookAt(0,0,0);
            starField.rotation.y += 0.0005;

            composer.render(); // 使用后期处理渲染器
        }

        animate();
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });

        // 初始化
        document.documentElement.style.setProperty('--accent', config["顽固"].color);
    </script>
</body>
</html>
